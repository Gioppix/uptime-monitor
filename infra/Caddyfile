{
    # Force production Let's Encrypt
    acme_ca https://acme-v02.api.letsencrypt.org/directory
}

# Node frontend subdomain (e.g., nbg1-1.uptime.giovannifeltrin.com)
${node_key}.${domain} {
    reverse_proxy localhost:${frontend_port}

    header {
        -Server
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}

# Node API subdomain (e.g., api.nbg1-1.uptime.giovannifeltrin.com)
${api_subdomain}.${node_key}.${domain} {
    reverse_proxy localhost:${backend_port}

    header {
        -Server
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
    }
}

%{ if is_primary ~}
# Main domain (only on primary region)
${domain} {
    reverse_proxy localhost:${frontend_port}

    header {
        -Server
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}

# Main API domain (only on primary region)
${api_subdomain}.${domain} {
    reverse_proxy localhost:${backend_port}

    header {
        -Server
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
    }
}

%{ endif ~}
